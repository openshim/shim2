/* ガウスの消去法（ピボット選択）*/
//#include"simio.h"

#define N 10  /* 行列の大きさ */

double a[N][N] = {{1.0000000,0.5000000,0.3333333,0.2500000,0.2000000,0.1666667,0.1428571,0.1250000,0.1111111,0.1000000},
		  {0.5000000,0.3333333,0.2500000,0.2000000,0.1666667,0.1428571,0.1250000,0.1111111,0.1000000,0.0909091},
		  {0.3333333,0.2500000,0.2000000,0.1666667,0.1428571,0.1250000,0.1111111,0.1000000,0.0909091,0.0833333},
		  {0.2500000,0.2000000,0.1666667,0.1428571,0.1250000,0.1111111,0.1000000,0.0909091,0.0833333,0.0769231},
		  {0.2000000,0.1666667,0.1428571,0.1250000,0.1111111,0.1000000,0.0909091,0.0833333,0.0769231,0.0714286},
		  {0.1666667,0.1428571,0.1250000,0.1111111,0.1000000,0.0909091,0.0833333,0.0769231,0.0714286,0.0666667},
		  {0.1428571,0.1250000,0.1111111,0.1000000,0.0909091,0.0833333,0.0769231,0.0714286,0.0666667,0.0625000},
		  {0.1250000,0.1111111,0.1000000,0.0909091,0.0833333,0.0769231,0.0714286,0.0666667,0.0625000,0.0588235},
		  {0.1111111,0.1000000,0.0909091,0.0833333,0.0769231,0.0714286,0.0666667,0.0625000,0.0588235,0.0555556},
		  {0.1000000,0.0909091,0.0833333,0.0769231,0.0714286,0.0666667,0.0625000,0.0588235,0.0555556,0.0526316}};
double b[N] = {1,2,3,4,5,6,7,8,9,10};
double w[N];
/*解
  66.95856118
  -5425.617828
  67466.74887
  -263641.5133
  311708.5357
  170017.9158
  -355778.1721
  -345545.5596
  645485.6537
  -223117.0561
  66.95856118
  -5425.617828
  67466.74887
  -263641.5133
  311708.5357
  170017.9158
  -355778.1721
  -345545.5596
  645485.6537
  -223117.0561
*/

double myfabs(double x){
  if(x < 0)
    return -x;
  else
    return x;
}

int main(){
  int i, j, k, p;
  double pmax, s;
  
  /* 前進消去（ピボット選択）*/
  
  for(k = 0; k < N-1; k++){  /* 第ｋステップ */
    p = k;
    pmax = myfabs( a[k][k] );
    for(i = k+1; i < N; i++){  /* ピボット選択 */
      if(myfabs( a[i][k] ) > pmax){
	p = i;
	pmax = myfabs( a[i][k] );
      }
    }
    
    /* エラー処理：ピボットがあまりに小さい時はメッセージを表示して終了　*/
    if(myfabs( pmax ) < 1.0e-12){
      // my_printf("too small pivot! \n");
      return (0);
    }
    if(p != k){  /* 第ｋ行と第ｐ行の交換　*/
      for(i = k; i < N; i++){
	/* 係数行列　*/
	s = a[k][i];
	a[k][i] = a[p][i];
	a[p][i] = s;
      }
      /* 既知ベクトル */
      s = b[k];
      b[k] = b[p];
      b[p] = s;
    }
    /* 前進消去 */
    for(i = k +1; i < N; i++){ /* 第ｉ行 */
      w[i] = a[i][k] / a[k][k];
      a[i][k] = 0.0;
      /* 第ｋ行を-a[i][k]/a[k][k]倍して、第ｉ行に加える */
      for(j = k + 1; j < N; j++){
	a[i][j] = a[i][j] - a[k][j] * w[i];
      }
      b[i] = b[i] - b[k] * w[i];
    }
  }
  /* 後退代入 */
  for(i = N - 1; i >= 0; i--){
    for(j = i + 1; j < N; j++){
      b[i] = b[i] - a[i][j] * b[j];
      a[i][j] = 0.0;
    }
    b[i] = b[i] / a[i][i];
    a[i][i] = 1.0;
  }

  /* 解の表示 */
  //for(i = 0; i < N; i++)my_printf("x[%2d] = %12.8lf\n",i+1,b[i]);
  
  return 0;
}
